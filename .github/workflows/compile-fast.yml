name: ğŸš€ Compiler LaTeX VERY FAST

on:
  workflow_dispatch:
    inputs:
      latex_content:
        description: 'Contenu LaTeX encodÃ© en base64'
        required: true
        type: string
      file_name:
        description: 'Nom de fichier'
        required: true
        type: string
      timestamp:
        description: 'Timestamp du dÃ©clenchement'
        required: false
        type: string

jobs:
  compile:
    runs-on: ubuntu-latest
    container:
      image: blang/latex:ubuntu  # Docker officiel avec TeX Live complet (LuaLaTeX inclus)
    timeout-minutes: 6
    
    steps:

    - name: CrÃ©er le fichier de test
      run: |
        echo '\documentclass{article}' > test.tex
        echo '\begin{document}' >> test.tex
        echo 'Hello World! Compilation rÃ©ussie!' >> test.tex
        echo '\end{document}' >> test.tex
        
        echo "ğŸ“‹ Contenu du fichier :"
        cat test.tex
    
    - name: ğŸ“ CrÃ©er le fichier proprement
      run: |
        echo "ğŸ“¥ RÃ©cupÃ©ration du contenu LaTeX..."
        # DÃ©coder le contenu base64
        echo "${{ github.event.inputs.latex_content }}" | base64 -d > temp_content.tex
        
        echo "ğŸ“‹ Construction du document complet..."
        # CrÃ©er l'en-tÃªte
        # echo '\documentclass{article}' > document.tex
        # echo '\usepackage[utf8]{inputenc}' >> document.tex
        # echo '\usepackage[french]{babel}' >> document.tex
        # echo '\begin{document}' >> document.tex
        
        # Ajouter le contenu utilisateur
        cat temp_content.tex >> document.tex
        
        # Ajouter la fin du document
        # echo '\end{document}' >> document.tex
        
        # Nettoyer
        rm temp_content.tex

        echo "âœ… Fichier crÃ©Ã© avec succÃ¨s"
        echo "ğŸ“Š Statistiques :"
        wc -l document.tex
        
        echo "ğŸ“‹ Contenu du fichier :"
        cat document.tex

    - name: Compiler avec LuaLaTeX
      run: |
        echo "ğŸš€ Compilation en cours..."
        lualatex --interaction=nonstopmode document.tex
        
        echo "ğŸ“Š RÃ©sultat :"
        ls -la

    - name: VÃ©rifier le PDF
      run: |
        if [ -f "document.pdf" ]; then
            echo "âœ… SUCCÃˆS ! PDF crÃ©Ã© avec succÃ¨s!"
            echo "ğŸ“ Taille : $(du -h document.pdf | cut -f1)"
        else
            echo "âŒ Ã‰CHEC : Aucun PDF gÃ©nÃ©rÃ©"
            echo "ğŸ” Listing des fichiers :"
            ls -la
            exit 1
        fi

    - name: TÃ©lÃ©charger le PDF
      uses: actions/upload-artifact@v4
      with:
        name: ${{ github.event.inputs.file_name }}
        path: document.pdf